<!-- --------------------------------------------------------------- -->
<style>
	:root {
		--figma-color-bg-theme: var(--figma-color-text);
		--figma-color-text-theme: var(--figma-color-bg);
		--screenshot-color-bg-checked: #1b6ef3;
		--screenshot-color-bg-checkmark-icon: #ffffff;
	}

	@media (prefers-color-scheme: dark) {
		:root {
			--screenshot-color-bg: #3b3b3b;
			--screenshot-color-bg-checked: #7cacf8;
			--screenshot-color-bg-checkmark-icon: #282828;

			--figma-color-bg: #2c2c2c;
			--figma-color-bg-brand: #0c8ce9;
			--figma-color-bg-brand-hover: #0a6dc2;
			--figma-color-bg-brand-pressed: #0a6dc2;
			--figma-color-bg-brand-secondary: #105cad;
			--figma-color-bg-brand-tertiary: #394360;
			--figma-color-bg-component: #8a38f5;
			--figma-color-bg-component-hover: #7a2ed6;
			--figma-color-bg-component-pressed: #7a2ed6;
			--figma-color-bg-component-secondary: #652ca8;
			--figma-color-bg-component-tertiary: #473956;
			--figma-color-bg-danger: #e03e1a;
			--figma-color-bg-danger-hover: #c4381c;
			--figma-color-bg-danger-pressed: #c4381c;
			--figma-color-bg-danger-secondary: #963323;
			--figma-color-bg-danger-tertiary: #7c2622;
			--figma-color-bg-disabled: #757575;
			--figma-color-bg-disabled-secondary: #b3b3b3;
			--figma-color-bg-hover: #383838;
			--figma-color-bg-inverse: #ffffff;
			--figma-color-bg-onselected: #667799;
			--figma-color-bg-onselected-hover: #667799;
			--figma-color-bg-onselected-pressed: #667799;
			--figma-color-bg-pressed: #383838;
			--figma-color-bg-secondary: #383838;
			--figma-color-bg-selected: #4a5878;
			--figma-color-bg-selected-hover: #536383;
			--figma-color-bg-selected-pressed: #536383;
			--figma-color-bg-selected-secondary: #394360;
			--figma-color-bg-selected-strong: #0c8ce9;
			--figma-color-bg-selected-tertiary: #394360;
			--figma-color-bg-success: #198f51;
			--figma-color-bg-success-hover: #078348;
			--figma-color-bg-success-pressed: #078348;
			--figma-color-bg-success-secondary: #0a5c35;
			--figma-color-bg-success-tertiary: #0a4c2d;
			--figma-color-bg-tertiary: #444444;
			--figma-color-bg-warning: #f3c11b;
			--figma-color-bg-warning-hover: #f2b50d;
			--figma-color-bg-warning-pressed: #f2b50d;
			--figma-color-bg-warning-secondary: #e4a711;
			--figma-color-bg-warning-tertiary: #c58011;
			--figma-color-border: #444444;
			--figma-color-border-brand: #105cad;
			--figma-color-border-brand-strong: #7cc4f8;
			--figma-color-border-component: #652ca8;
			--figma-color-border-component-hover: #8a38f5;
			--figma-color-border-component-strong: #d6b6fb;
			--figma-color-border-danger: #963323;
			--figma-color-border-danger-strong: #fca397;
			--figma-color-border-disabled: #444444;
			--figma-color-border-disabled-strong: #ffffff66;
			--figma-color-border-onbrand: #0a6dc2;
			--figma-color-border-onbrand-strong: #ffffff;
			--figma-color-border-oncomponent: #7a2ed6;
			--figma-color-border-oncomponent-strong: #ffffff;
			--figma-color-border-ondanger: #c4381c;
			--figma-color-border-ondanger-strong: #ffffff;
			--figma-color-border-onselected: #667799;
			--figma-color-border-onselected-strong: #ffffffe5;
			--figma-color-border-onsuccess: #078348;
			--figma-color-border-onsuccess-strong: #ffffff;
			--figma-color-border-onwarning: #e4a711;
			--figma-color-border-onwarning-strong: #000000e5;
			--figma-color-border-selected: #0c8ce9;
			--figma-color-border-selected-strong: #7cc4f8;
			--figma-color-border-strong: #ffffffe5;
			--figma-color-border-success: #0a5c35;
			--figma-color-border-success-strong: #79d297;
			--figma-color-border-warning: #925711;
			--figma-color-border-warning-strong: #f7d15f;
			--figma-color-icon: #ffffff;
			--figma-color-icon-brand: #7cc4f8;
			--figma-color-icon-brand-pressed: #0c8ce9;
			--figma-color-icon-brand-secondary: #536383;
			--figma-color-icon-brand-tertiary: #394360;
			--figma-color-icon-component: #d1a8ff;
			--figma-color-icon-component-pressed: #d6b6fb;
			--figma-color-icon-component-secondary: #6b5884;
			--figma-color-icon-component-tertiary: #6b5884;
			--figma-color-icon-danger: #e03e1a;
			--figma-color-icon-danger-hover: #fbbcb6;
			--figma-color-icon-danger-pressed: #fbbcb6;
			--figma-color-icon-danger-secondary: #e03e1a;
			--figma-color-icon-danger-secondary-hover: #e03e1a;
			--figma-color-icon-danger-tertiary: #e03e1a;
			--figma-color-icon-disabled: #ffffff66;
			--figma-color-icon-hover: #ffffff;
			--figma-color-icon-onbrand: #ffffff;
			--figma-color-icon-onbrand-secondary: #ffffffcc;
			--figma-color-icon-onbrand-tertiary: #ffffff66;
			--figma-color-icon-oncomponent: #ffffff;
			--figma-color-icon-oncomponent-secondary: #ffffffcc;
			--figma-color-icon-oncomponent-tertiary: #ffffff66;
			--figma-color-icon-ondanger: #ffffff;
			--figma-color-icon-ondanger-secondary: #ffffffcc;
			--figma-color-icon-ondanger-tertiary: #ffffff66;
			--figma-color-icon-ondisabled: #2c2c2c;
			--figma-color-icon-oninverse: #000000e5;
			--figma-color-icon-onselected: #ffffff;
			--figma-color-icon-onselected-secondary: #ffffffb2;
			--figma-color-icon-onselected-strong: #ffffff;
			--figma-color-icon-onselected-tertiary: #ffffff66;
			--figma-color-icon-onsuccess: #ffffff;
			--figma-color-icon-onsuccess-secondary: #ffffffcc;
			--figma-color-icon-onsuccess-tertiary: #ffffff66;
			--figma-color-icon-onwarning: #000000e5;
			--figma-color-icon-onwarning-secondary: #00000080;
			--figma-color-icon-onwarning-tertiary: #0000004d;
			--figma-color-icon-pressed: #0a6dc2;
			--figma-color-icon-secondary: #ffffffb2;
			--figma-color-icon-secondary-hover: #ffffff;
			--figma-color-icon-selected: #7cc4f8;
			--figma-color-icon-selected-secondary: #7cc4f8;
			--figma-color-icon-selected-tertiary: #7cc4f8;
			--figma-color-icon-success: #198f51;
			--figma-color-icon-success-pressed: #a1e8b9;
			--figma-color-icon-success-secondary: #198f51;
			--figma-color-icon-success-tertiary: #198f51;
			--figma-color-icon-tertiary: #ffffff66;
			--figma-color-icon-tertiary-hover: #ffffff;
			--figma-color-icon-warning: #f3c11b;
			--figma-color-icon-warning-pressed: #f7d15f;
			--figma-color-icon-warning-secondary: #f3c11b;
			--figma-color-icon-warning-tertiary: #f3c11b;
			--figma-color-text: #ffffff;
			--figma-color-text-brand: #7cc4f8;
			--figma-color-text-brand-secondary: #7cc4f8;
			--figma-color-text-brand-tertiary: #7cc4f8;
			--figma-color-text-component: #d1a8ff;
			--figma-color-text-component-pressed: #d6b6fb;
			--figma-color-text-component-secondary: #6b5884;
			--figma-color-text-component-tertiary: #6b5884;
			--figma-color-text-danger: #fca397;
			--figma-color-text-danger-secondary: #fca397;
			--figma-color-text-danger-tertiary: #fca397;
			--figma-color-text-disabled: #ffffff66;
			--figma-color-text-hover: #ffffff;
			--figma-color-text-onbrand: #ffffff;
			--figma-color-text-onbrand-secondary: #ffffffcc;
			--figma-color-text-onbrand-tertiary: #ffffff66;
			--figma-color-text-oncomponent: #ffffff;
			--figma-color-text-oncomponent-secondary: #ffffffcc;
			--figma-color-text-oncomponent-tertiary: #ffffff66;
			--figma-color-text-ondanger: #ffffff;
			--figma-color-text-ondanger-secondary: #ffffffcc;
			--figma-color-text-ondanger-tertiary: #ffffff66;
			--figma-color-text-ondisabled: #2c2c2c;
			--figma-color-text-oninverse: #000000e5;
			--figma-color-text-onselected: #ffffffe5;
			--figma-color-text-onselected-secondary: #ffffffb2;
			--figma-color-text-onselected-strong: #ffffff;
			--figma-color-text-onselected-tertiary: #ffffff66;
			--figma-color-text-onsuccess: #ffffff;
			--figma-color-text-onsuccess-secondary: #ffffffcc;
			--figma-color-text-onsuccess-tertiary: #ffffff66;
			--figma-color-text-onwarning: #000000e5;
			--figma-color-text-onwarning-secondary: #00000080;
			--figma-color-text-onwarning-tertiary: #0000004d;
			--figma-color-text-secondary: #ffffffb2;
			--figma-color-text-secondary-hover: #ffffff;
			--figma-color-text-selected: #7cc4f8;
			--figma-color-text-selected-secondary: #7cc4f8;
			--figma-color-text-selected-tertiary: #7cc4f8;
			--figma-color-text-success: #79d297;
			--figma-color-text-success-secondary: #79d297;
			--figma-color-text-success-tertiary: #79d297;
			--figma-color-text-tertiary: #ffffff66;
			--figma-color-text-tertiary-hover: #ffffff;
			--figma-color-text-warning: #f7d15f;
			--figma-color-text-warning-secondary: #f7d15f;
			--figma-color-text-warning-tertiary: #f7d15f;
		}
	}

	body {
		background-color: #3c3c3c;
	}

	.show-dimensions {
		/* outline: none; */
		display: flex !important;
		opacity: 1 !important;
	}

	.show-dimensions label {
		opacity: 1;
		transition-property: opacity;
		transition-duration: 400ms;
	}

	/* Shrink scrollbar width */
	#dimensions-list::-webkit-scrollbar {
		width: 0px; /* Adjust the width as needed */
	}

	#dimensions-list::-webkit-scrollbar-thumb {
		background-color: darkgrey; /* Color of the scrollbar thumb */
		border-radius: 10px; /* Rounded corners */
	}

	#dimensions-list::-webkit-scrollbar-track {
		background: lightgrey; /* Color of the scrollbar track */
	}
</style>

<main class="app h-full flex flex-col bg-[var(--figma-color-bg)]">
	<header class="flex flex-col justify-center py-4 gap-4">
		<!-- URL search component -->
		<input
			class="px-4 py-1 rounded-sm max-w-[500px] w-full"
			type="text"
			id="screenshot-url-input"
			placeholder="Enter image URL" />

		<!-- Other components -->
		<div class="relative flex gap-3 text-center">
			<!-- Dimensions selection component -->
			<section class="outline relative flex flex-col">
				<div>
					<button
						type="button"
						id="dimensions-btn"
						class="whitespace-nowrap px-4 py-1 text-left rounded-lg h-[32] text-[var(--figma-color-text)]">
						Dimensions:
						<span id="selected-dimension">Pixel 7a</span>
					</button>
					<ul
						id="dimensions-list"
						class="bg-[var(--figma-color-bg)] top-12 absolute hidden rounded-md p-2 max-h-[520px] gap-2 overflow-y-scroll flex-col flex-start">
						<!-- Dynamically created dimensions -->
					</ul>
				</div>
			</section>

			<!-- Dimensions width-x-height input component -->
			<section class="flex gap-2">
				<input
					class="w-[80px] px-2 py-1 text-center"
					type="number"
					id="dimension-width"
					value="390" />
				<span class="text-[var(--figma-color-text)] m-auto">
					<svg
						width="16"
						height="16"
						viewBox="0 0 24 24"
						fill="none"
						xmlns="http://www.w3.org/2000/svg">
						<path
							d="M4.18836 4.38931L4.28179 4.28179C4.44434 4.11922 4.65982 4.02037 4.88908 4.00322C5.11833 3.98607 5.34613 4.05177 5.53104 4.18836L5.63856 4.28179L12 10.642L18.3614 4.28051C18.5241 4.11813 18.7397 4.01951 18.969 4.0026C19.1982 3.98569 19.4259 4.0516 19.6107 4.18836L19.7182 4.28179C19.8808 4.44434 19.9796 4.65982 19.9968 4.88908C20.0139 5.11833 19.9482 5.34613 19.8116 5.53104L19.7182 5.63856L13.358 12L19.7195 18.3614C19.8819 18.5241 19.9805 18.7397 19.9974 18.969C20.0143 19.1982 19.9484 19.4259 19.8116 19.6107L19.7182 19.7182C19.5557 19.8808 19.3402 19.9796 19.1109 19.9968C18.8817 20.0139 18.6539 19.9482 18.469 19.8116L18.3614 19.7182L12 13.358L5.63856 19.7195C5.47586 19.8819 5.26029 19.9805 5.03104 19.9974C4.80179 20.0143 4.57408 19.9484 4.38931 19.8116L4.28179 19.7182C4.11922 19.5557 4.02037 19.3402 4.00322 19.1109C3.98607 18.8817 4.05177 18.6539 4.18836 18.469L4.28179 18.3614L10.642 12L4.28051 5.63856C4.11813 5.47586 4.01951 5.26029 4.0026 5.03104C3.98569 4.80179 4.0516 4.57408 4.18836 4.38931Z"
							class="fill-[var(--figma-color-text)]"></path>
					</svg>
				</span>
				<input
					class="w-[80px] px-2 py-1 text-center"
					type="number"
					id="dimension-height"
					value="844" />
			</section>

			<!-- Dimensions zoom input component -->
			<section>
				<input
					class="text-center px-2 py-1 w-[80px]"
					type="text"
					value="100%"
					id="zoom" />
			</section>

			<!-- Dimensions options component -->
			<section class="additional options">
				<svg
					width="24px"
					height="24px"
					viewBox="0 0 24 24"
					fill="none"
					xmlns="http://www.w3.org/2000/svg">
					<g id="SVGRepo_bgCarrier" stroke-width="0"></g>
					<g
						id="SVGRepo_tracerCarrier"
						stroke-linecap="round"
						stroke-linejoin="round"></g>
					<g id="SVGRepo_iconCarrier">
						<path
							class="stroke-[var(--figma-color-text)]"
							d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"></path>
						<path
							class="stroke-[var(--figma-color-text)]"
							d="M12 6C12.5523 6 13 5.55228 13 5C13 4.44772 12.5523 4 12 4C11.4477 4 11 4.44772 11 5C11 5.55228 11.4477 6 12 6Z"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"></path>
						<path
							class="stroke-[var(--figma-color-text)]"
							d="M12 20C12.5523 20 13 19.5523 13 19C13 18.4477 12.5523 18 12 18C11.4477 18 11 18.4477 11 19C11 19.5523 11.4477 20 12 20Z"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"></path>
					</g>
				</svg>
			</section>
		</div>
	</header>

	<!-- Image component-->
	<div class="resize overflow-auto h-full rounded-lg" id="image-frame">
		<img class="outline-none" src="" id="image-content" class="h-full" />
	</div>
</main>

<script src="https://cdn.tailwindcss.com"></script>
<script>
	// #region elements
	const screenshotUrlInput = document.getElementById("screenshot-url-input");
	const dimensionsBtn = document.getElementById("dimensions-btn");
	let dimensionText = document.getElementById("selected-dimension");
	const dimensionsList = document.getElementById("dimensions-list");
	// prettier-ignore
	const dimensionListItems = document.getElementsByClassName("dimensions-list-item");
	const dimensionWidth = document.getElementById("dimension-width");
	const dimensionHeight = document.getElementById("dimension-height");
	const imageFrame = document.getElementById("image-frame");

	// #endregion elements

	// ------------------------------------------------------------------
	// #region server events
	// message listners for incoming server messages
	onmessage = (event) => {
		if (event.data.pluginMessage.type === "data-dimensions") {
			renderDimensions(JSON.parse(event.data.pluginMessage.dimensions));
		}

		if (event.data.pluginMessage.type === "image") {
			const blob = new Blob([event.data.pluginMessage.uint8Array], {
				type: "image/png",
			});

			const imageUrl = URL.createObjectURL(blob);
			const img = document.getElementById("image-content");
			img.src = imageUrl;
		}
	};

	// #endregion server events

	// ------------------------------------------------------------------

	// #region  dynamically rendered markup
	function renderDimensions(dimensions) {
		function editWords(words) {
			const wordsArray = words.split(" ");
			return wordsArray
				.map((word) => {
					switch (word) {
						case "iphone":
							return "iPhone";
						case "se":
							return "SE";
						default:
							return word.charAt(0).toUpperCase() + word.slice(1);
					}
				})
				.join(" ");
		}

		function createDimensions(dimensions) {
			const dimensionsList = document.getElementById("dimensions-list");
			dimensions.map((dimension) => {
				const dimensionEl = document.createElement("li");

				// add styles
				dimensionEl.classList.add("dimensions-list-item");
				dimensionEl.classList.add("group");
				dimensionEl.classList.add("hover:bg-[var(--figma-color-bg-theme)]");
				dimensionEl.classList.add("rounded-lg");

				// add markup
				dimensionEl.innerHTML = `
				<label class="w-full flex gap-[8px] p-2 px-4 cursor-pointer"
					for="${dimension.deviceName.toLowerCase().split(" ").join("-")}">
					<input
						data-deviceName="${dimension.deviceName}"
						data-dimension="${dimension.width},${dimension.height}"
						class="w-4 h-4 my-auto"
						type="checkbox"
						id="${dimension.deviceName.toLowerCase().split(" ").join("-")}"
						name="${dimension.deviceName.toLowerCase().split(" ").join("-")}"}"
						value="${dimension.deviceName.toLowerCase().split(" ").join("-")}"}" />
						<span
							class="whitespace-nowrap group-hover:text-[var(--figma-color-text-theme)]
							text-[var(--figma-color-text)] p-2 px-4">
							${dimension.deviceName}
					</span>
				</label>
				`;
				dimensionsList.appendChild(dimensionEl);

				// event listeners
				dimensionEl.addEventListener("click", (event) => {
					switch (event.target.tagName) {
						case "SPAN":
							return;
						case "LABEL":
							return;
						default:
							break;
					}

					dimensionWidth.value = event.target.dataset.dimension.split(",")[0];
					dimensionHeight.value = event.target.dataset.dimension.split(",")[1];
					dimensionText.innerText = event.target.dataset.devicename;
				});
			});
		}

		createDimensions(dimensions);
	}
	// #endregion  dynamically rendered markup

	// ------------------------------------------------------------------

	// #region event listeners
	const resizeObserver = new ResizeObserver(handleImageFrameResize);
	resizeObserver.observe(imageFrame);

	screenshotUrlInput.addEventListener("input", async (event) =>
		handleScreenshotUrlInput(event)
	);

	dimensionsBtn.addEventListener("click", (event) =>
		handleDimensionsBtnClick(event)
	);

	dimensionWidth.addEventListener("input", (event) => {
		handleDimensionWidthInput(event);
	});
	dimensionWidth.addEventListener("input", (event) => {
		handleDimensionHeightInput(event);
	});

	// #endregion event listeners

	// #region handlers
	function handleScreenshotUrlInput(event) {
		if (screenshotUrlInput.value.includes("https://google.com/")) {
			const urlToScreenshot = screenshotUrlInput.value;
			parent.postMessage(
				{
					pluginMessage: {
						type: "load-image",
						urlToScreenshot,
					},
				},
				"*"
			);
		}
	}

	function handleDimensionsBtnClick(event) {
		dimensionsList.classList.toggle("show-dimensions");
	}

	function handleDimensionWidthInput(event) {
		const MINIMUM_WIDTH = 400;
		const inputValue = parseInt(event.target.value);
		const width = inputValue > MINIMUM_WIDTH ? inputValue : MINIMUM_WIDTH;

		if (inputValue > MINIMUM_WIDTH) {
			parent.postMessage(
				{
					pluginMessage: {
						type: "resize-app",
						width,
					},
				},
				"*"
			);
		}
		if (inputValue <= MINIMUM_WIDTH && inputValue >= 320) {
			imageFrame.width = width;
		}
	}

	function handleDimensionHeightInput(event) {
		const height = parseInt(event.target.value);
		const heightWithMinimum = height > 400 ? height : 400;

		imageFrame.style.width = height;
		parent.postMessage(
			{
				pluginMessage: {
					type: "resize-app",
					heightWithMinimum,
				},
			},
			"*"
		);
	}

	function handleImageFrameResize(entry) {
		// console.log(entry[0]["borderBoxSize"]);
		// console.log(entry[0]["contentBoxSize"]);
		// const contentRect = entry[0]["contentRect"];
		// console.log(contentRect);
		// console.log(entry[0]["devicePixelContentBoxSize"]);
		// console.log(entry[0]["target"]);
		// dimensionWidth.value = contentRect.width;
		// dimensionHeight.value = contentRect.height;
	}

	// #endregion handlers
</script>
